<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE CLASS: ENGLISH ASSISTANT</title>
    <!-- エレガントなフォントは継続し、洗練された印象に -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400;1,700&family=Noto+Sans+JP:wght@300;400;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            /* 会社の会議で映える、落ち着いたプロフェッショナルな配色 */
            --bg-body: #F9F9F7;
            /* 柔らかいオフホワイト */
            --text-main: #2C2C2C;
            /* 真っ黒ではなく、上品なダークグレー */
            --color-accent: #B09870;
            /* 落ち着いたゴールド/サンドベージュ */
            --bg-panel: #FFFFFF;
            /* パネル用の白 */
            --text-light: #666666;
            /* 説明文用の柔らかなグレー */
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            line-height: 1.8;
            font-size: 16px;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* 英語の見出しにPlayfair Displayを適用 */
        h1,
        h2,
        h3,
        .serif-font {
            font-family: 'Playfair Display', serif;
        }

        /* --- 控えめで上品なアニメーション (会議用) --- */
        /* 1. 非常にゆっくりとした浮遊 (目障りにならない程度に) */
        @keyframes floatGentle {
            0% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-8px);
            }

            100% {
                transform: translateY(0);
            }
        }

        .float-subtle {
            animation: floatGentle 6s ease-in-out infinite;
        }

        .float-subtle.delay {
            animation-delay: 3s;
        }

        /* 2. パララックス効果のためのクラス (JavaScriptと連携) */
        .parallax-item {
            transition: transform 0.1s ease-out;
        }

        /* 3. スクロールに合わせたフェードイン (CSS) */
        .fade-in {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 1s cubic-bezier(0.2, 0.8, 0.2, 1), transform 1s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        .fade-in.is-visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* --- 共通レイアウト --- */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 40px;
        }

        /* --- ヘッダー --- */
        header {
            padding: 30px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            background-color: var(--bg-panel);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.02);
            transition: transform 0.3s ease;
        }

        .logo {
            font-size: 20px;
            font-weight: 700;
            letter-spacing: 2px;
            color: var(--text-main);
        }

        .header-sub {
            font-size: 13px;
            color: var(--text-light);
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        /* --- ファーストビュー (Top Area) --- */
        .hero {
            height: 100vh;
            padding-top: 90px;
            display: flex;
            align-items: center;
            position: relative;
            overflow: hidden;
            background-color: var(--bg-panel);
        }

        .hero-inner {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            position: relative;
            z-index: 2;
        }

        .hero-text-box {
            flex: 0 0 50%;
            /* テキストエリアの幅を固定 */
            max-width: 600px;
            padding: 40px 60px 40px 0px;
            position: relative;
            z-index: 10;
            /* 画像の上に表示されるようにする */
            /* 画像と重なっても文字が読めるように、背景に半透明のグラデーション・ガラス効果を付与 */
            background: linear-gradient(to right, rgba(249, 249, 247, 0.95) 40%, rgba(249, 249, 247, 0.7) 80%, rgba(249, 249, 247, 0) 100%);
            border-radius: 8px;
            text-shadow: 0 2px 10px rgba(255, 255, 255, 0.8);
        }

        .hero-title {
            font-size: clamp(40px, 6vw, 84px);
            font-weight: 400;
            line-height: 1.1;
            margin-bottom: 30px;
            color: var(--text-main);
        }

        .hero-title i {
            color: var(--color-accent);
        }

        .hero-subtitle {
            font-size: 18px;
            color: var(--text-light);
            font-weight: 300;
            max-width: 500px;
            line-height: 2;
            margin-bottom: 40px;
        }

        /* プレゼン用に余白を活かした配置 */
        .hero-image-box {
            position: absolute;
            right: -30px;
            /* 画面右端まで寄せる */
            top: 50%;
            transform: translateY(-50%);
            width: 65%;
            /* 画面の2/3を占めるように大きく */
            height: 85vh;
            /* 高さも画面いっぱいに近く */
            display: flex;
            justify-content: flex-end;
            align-items: center;
            z-index: 1;
            /* テキストの裏側に潜り込ませる */
        }

        /* 会議でも品が良く見える、落ち着いたトーンの画像枠 */
        .hero-image {
            width: 100%;
            height: 100%;
            /* ボックスの最大サイズまで広げる */
            object-fit: contain;
            /* 縦横比を絶対に崩さず、最大まで拡大 */
            border-radius: 4px;
            /* 背景と同化しすぎないように微かな影 */
            filter: drop-shadow(0 20px 40px rgba(0, 0, 0, 0.08));
            /* 静かに浮遊する効果 */
            animation: floatGentle 8s ease-in-out infinite;
        }

        /* 後ろに配置された装飾的な色のブロック */
        .hero-deco {
            position: absolute;
            top: 10%;
            right: 0%;
            width: 80%;
            height: 80%;
            background-color: rgba(176, 152, 112, 0.08);
            /* アクセントカラーの極薄い色 */
            z-index: -1;
            border-radius: 4px;
        }

        /* --- セクション: THE FEATURES --- */
        .section-features {
            padding: 150px 0;
            background-color: var(--bg-body);
        }

        .section-header {
            text-align: center;
            margin-bottom: 100px;
            position: relative;
        }

        .section-quote {
            max-width: 800px;
            margin: -40px auto 60px auto;
            /* 上へ少しはみ出させて、全体の高さを維持する工夫 */
            font-size: 14.5px;
            line-height: 2.2;
            color: var(--text-light);
            text-align: center;
        }

        .section-label {
            font-size: 12px;
            color: var(--color-accent);
            letter-spacing: 4px;
            text-transform: uppercase;
            font-weight: 700;
            margin-bottom: 15px;
            display: block;
        }

        .section-title {
            font-size: 42px;
            font-weight: 400;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 100px;
            align-items: center;
            margin-bottom: 120px;
        }

        /* 左右交互のレイアウト */
        .feature-grid:nth-child(even) {
            background-color: #FFFFFF;
            padding: 80px 60px;
            border-radius: 8px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.03);
        }

        .feature-text {
            flex: 1;
        }

        .feature-number {
            font-size: 60px;
            font-weight: 300;
            color: var(--color-accent);
            opacity: 0.5;
            line-height: 1;
            margin-bottom: 20px;
        }

        .feature-text h3 {
            font-size: 32px;
            margin-bottom: 20px;
            font-weight: 400;
        }

        .feature-text p {
            font-size: 16px;
            color: var(--text-light);
            line-height: 2;
        }

        .feature-image-wrapper {
            position: relative;
            /* 画像コンテナがスクロールに合わせて少しずれる (JavaScriptによる簡素なパララックス用) */
            height: 400px;
            overflow: hidden;
            border-radius: 4px;
        }

        .feature-image-wrapper img {
            width: 100%;
            height: 120%;
            /* パララックスの余白のために少し大きく */
            object-fit: cover;
            /* JSから transform を当てるクラス */
            position: absolute;
            top: -10%;
            left: 0;
        }

        /* --- セクション: HOW IT WORKS --- */
        .section-how {
            padding: 120px 0;
            background-color: var(--text-main);
            color: #FFFFFF;
            text-align: center;
        }

        .section-how .section-title {
            color: #FFFFFF;
            margin-bottom: 80px;
        }

        .step-cards {
            display: flex;
            justify-content: space-between;
            gap: 40px;
        }

        .step-card {
            flex: 1;
            background-color: rgba(255, 255, 255, 0.05);
            padding: 60px 40px;
            border-top: 4px solid var(--color-accent);
            text-align: left;
            transition: background-color 0.3s;
        }

        .step-card:hover {
            background-color: rgba(255, 255, 255, 0.08);
        }

        .step-card h4 {
            font-size: 20px;
            margin-bottom: 15px;
            font-weight: 400;
            color: #FFFFFF;
        }

        .step-card p {
            font-size: 14px;
            color: #BBBBBB;
            line-height: 1.8;
        }

        /* Teacher's Note */
        .teacher-box {
            max-width: 800px;
            margin: 100px auto 0;
            padding: 40px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background-color: #222;
            border-radius: 4px;
            text-align: left;
        }

        .teacher-box-title {
            color: var(--color-accent);
            font-size: 14px;
            margin-bottom: 12px;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        /* --- 4. Lightbox (モーダル画像拡大) --- */
        .lightbox-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(10, 10, 10, 0.95);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease;
        }

        .lightbox-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .lightbox-slider {
            position: relative;
            width: 95%;
            /* 横幅を画面の95%まで広げる */
            max-width: 1400px;
            /* PCでも十分大きく表示できるよう上限を上げる */
            height: 90vh;
            /* 高さも画面の90%まで広げる */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .lightbox-img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            opacity: 0;
            transform: scale(0.95);
            transition: opacity 0.3s ease, transform 0.3s ease;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            display: none;
        }

        .lightbox-img.active {
            opacity: 1;
            transform: scale(1);
            display: block;
        }

        /* 虫眼鏡拡大機能のCSS */
        .zoom-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            /* 拡大画像が枠外にはみ出ないようにする */
            cursor: zoom-in;
        }

        .zoom-lens {
            position: absolute;
            width: 480px;
            /* 480pxに戻す */
            height: 200px;
            border-radius: 24px;
            /* 背景と混ざらないように、レンズの縁をくっきりさせる工夫 */
            border: 3px solid rgba(255, 255, 255, 0.9);
            /* 白枠を少し太く・濃く */
            box-shadow:
                0 0 30px rgba(0, 0, 0, 0.8),
                /* 外側に濃い影を落として背景から浮かせる */
                inset 0 0 20px rgba(255, 255, 255, 0.5);
            /* レンズの内側に光沢（白い影）を入れてガラスっぽくする */
            background-repeat: no-repeat;
            pointer-events: none;
            /* レンズ自体がマウスイベントを邪魔しないように */
            display: none;
            /* 初期は非表示 */
            z-index: 10;
            background-color: rgba(255, 255, 255, 0.15);
            /* レンズ自体もほんの少しだけ白く濁らせて視認性を上げる */
        }

        /* ドラッグ中のカーソル */
        .zoom-container.is-zooming {
            cursor: none;
            /* ズーム中は元のカーソルを消す */
        }

        .lightbox-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .lightbox-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .lightbox-prev {
            left: -60px;
        }

        .lightbox-next {
            right: -60px;
        }

        .lightbox-close {
            position: absolute;
            top: 20px;
            right: 30px;
            background: transparent;
            color: white;
            border: none;
            font-size: 36px;
            cursor: pointer;
            z-index: 10000;
        }

        .lightbox-indicator {
            position: absolute;
            bottom: -40px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-family: 'Playfair Display', serif;
            letter-spacing: 2px;
        }

        /* 画像をクリック可能であることを示すカーソル */
        .gallery-trigger {
            cursor: zoom-in;
            position: relative;
        }

        .gallery-trigger::after {
            content: 'Click to open gallery';
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            padding: 8px 16px;
            font-size: 12px;
            border-radius: 20px;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .gallery-trigger:hover::after {
            opacity: 1;
        }

        @media (max-width: 900px) {
            .hero-inner {
                flex-direction: column;
                text-align: center;
                margin-top: 50px;
            }

            .hero-text-box {
                flex: none;
                width: 100%;
                max-width: 100%;
                padding: 20px;
                background: rgba(249, 249, 247, 0.85);
            }

            .hero-image-box {
                position: relative;
                width: 100%;
                height: 50vh;
                top: auto;
                right: auto;
                transform: none;
                margin-top: -80px;
                /* テキストの裏に少し潜り込ませる */
                z-index: 1;
            }

            .lightbox-prev {
                left: 10px;
            }

            .lightbox-next {
                right: 10px;
            }
        }
    </style>
</head>

<body>

    <header>
        <div class="logo serif-font">January 30, 2026</div>
        <div class="header-sub">Yusuhara High School</div>
    </header>

    <!-- ファーストビュー -->
    <section class="hero">
        <div class="container hero-inner fade-in">
            <div class="hero-text-box">
                <h1 class="hero-title">Elevate Your<br>Learning <i>Experience.</i></h1>
                <p class="hero-subtitle">
                    Googleスプレッドシート × GAS で実装する<br>個別最適・協働的な学びの支援。<br>
                    目の前の生徒たち専用の教材でありながら、<br>教師の業務効率化も実現します。
                </p>
            </div>

            <div class="hero-image-box">
                <div class="hero-deco"></div>
                <!-- 画像フォルダ(images)内に hero-image.jpg を入れてください -->
                <img src="./images/hero-image.jpg" alt="Students learning" class="hero-image">
            </div>
        </div>
    </section>

    <!-- 特徴セクション -->
    <section class="section-features">
        <div class="container">
            <div class="section-header fade-in">
                <p class="section-quote">
                    ウルグアイの元大統領、ホセ・ムヒカは「世界で最も貧しい大統領」として知られています。<br>
                    彼は真の豊かさとは物質的な豊かさではなく、愛と友と過ごす時間にあると説きました。<br>
                    本時は教材を通して、「"Poor"の意味を再定義する」ことが目標です。
                </p>
                <span class="section-label">Core Value</span>
                <h2 class="section-title">実装した3つの機能</h2>
            </div>

            <!-- 機能1：上下にゆっくり浮遊させるクラス（float-subtle）を付与 -->
            <div class="feature-grid fade-in">
                <div class="feature-text">
                    <div class="feature-number serif-font">01</div>
                    <h3 class="serif-font">Express Opinions.</h3>
                    <p>教師は配布する質問シート（Q1,
                        Q2...）を一括生成し、生徒は自身の意見を英語でタイピング。他者の入力内容も同一画面内で閲覧できる他者参照の機能を有し、グループワークに近い多角的な視点の共有を自然に促します。</p>
                </div>
                <div class="feature-image-wrapper float-subtle gallery-trigger" data-gallery="feature1">
                    <!-- 画像フォルダ(images)内に feature-01.png を入れてください -->
                    <!-- imgに parallax-item を付与 -->
                    <img src="./images/feature-01.png"
                        data-images="./images/feature-01.png,./images/feature1/sub1.png,./images/feature1/sub2.png,./images/feature1/sub3.png,./images/feature1/sub4.png"
                        alt="Feature 1" class="parallax-item">
                </div>
            </div>

            <!-- 機能2: 写真左・テキスト右の配置 -->
            <div class="feature-grid fade-in">
                <div class="feature-image-wrapper float-subtle delay gallery-trigger" data-gallery="feature2">
                    <!-- 画像フォルダ(images)内に feature-02.png を入れてください -->
                    <img src="./images/feature-02.png"
                        data-images="./images/feature-02.png,./images/feature2/sub1.png,./images/feature2/sub2.png,./images/feature2/sub3.png,./images/feature2/sub4.png,./images/feature2/sub5.png"
                        alt="Feature 2" class="parallax-item">
                </div>
                <div class="feature-text">
                    <div class="feature-number serif-font">02</div>
                    <h3 class="serif-font">Translation Helper.</h3>
                    <p>わからない単語や表現に直面した際、タブを切り替えることなくその場で<strong>Translation
                            Helper</strong>を起動。一時的な「翻訳の補助」をスムーズに組み込むことで英語が苦手な生徒をサポートします。</p>
                </div>
            </div>

            <!-- 機能3 -->
            <div class="feature-grid fade-in">
                <div class="feature-text">
                    <div class="feature-number serif-font">03</div>
                    <h3 class="serif-font">Review History.</h3>
                    <p>サイドバーの<strong>Review My
                            Answers</strong>を開き、リストから自身を選択するだけで、これまでの回答と自分の判断を俯瞰できます。友達とのやり取りの際にこの部分を参照し、互いの意見を交流します。どの話題について話し合うか、また友達の意見をどう思うか、表示される情報自体が「やり取り」の支援ツールの役目も果たします。
                    </p>
                </div>
                <div class="feature-image-wrapper float-subtle gallery-trigger" data-gallery="feature3">
                    <!-- 画像フォルダ(images)内に feature-03.png を入れてください -->
                    <img src="./images/feature-03.png"
                        data-images="./images/feature-03.png,./images/feature3/sub1.png,./images/feature3/sub2.png,./images/feature3/sub3.png,./images/feature3/sub4.png,./images/feature3/sub5.png"
                        alt="Feature 3" class="parallax-item">
                </div>
            </div>
        </div>
    </section>

    <!-- 使い方セクション (シックなダークエリア) -->
    <section class="section-how">
        <div class="container">
            <div class="section-header fade-in">
                <span class="section-label">How to use</span>
                <h2 class="section-title">直感的な操作手順</h2>
            </div>

            <div class="step-cards fade-in">
                <div class="step-card">
                    <h4 class="serif-font">Step 1. Access Menu</h4>
                    <p>ツールバーに追加される「★Class Menu」をクリックして、全ての機能にアクセスします。</p>
                </div>

                <div class="step-card">
                    <h4 class="serif-font">Step 2. Cast Translate</h4>
                    <p>翻訳パネルに調べたい文章を入力し、クリック一つで日・英双方向の翻訳結果を取得します。</p>
                </div>

                <div class="step-card">
                    <h4 class="serif-font">Step 3. Show Answers</h4>
                    <p>メニューから回答のレビューを選択。右側に展開するパネルから名前を選ぶだけのシンプル設計。</p>
                </div>
            </div>

            <!-- 教員・管理者向け情報 -->
            <div class="teacher-box fade-in">
                <div class="teacher-box-title">For Administrators (教員向け運用規定)</div>
                <p style="font-size: 14px; line-height: 1.8; color: #CCCCCC;">
                    「設定」シートに該当クラスの生徒名簿および設問リストを定義した上で、メニューより<strong>1. Create Question
                        Sheets</strong>を実行してください。生徒人数に応じた解答シートが一括で自動生成されます。<br><br>
                    ※セキュリティ対策として、本実行メニューは「ファイルオーナー（教員）」のみに操作権限が限定されています。生徒による誤操作を防止する仕組みを実装済みです。
                </p>
            </div>
        </div>
    </section>

    <!-- 巨大なLightboxオーバーレイ (初期状態は非表示) -->
    <div class="lightbox-overlay" id="lightbox">
        <button class="lightbox-close" id="lb-close">&times;</button>
        <div class="lightbox-slider">
            <button class="lightbox-btn lightbox-prev" id="lb-prev">&#10094;</button>

            <div id="lb-image-container" class="zoom-container">
                <!-- JavaScriptでここに画像(img)エレメントと拡大レンズが挿入されます -->
                <div class="zoom-lens" id="zoom-lens"></div>
            </div>

            <button class="lightbox-btn lightbox-next" id="lb-next">&#10095;</button>
            <div class="lightbox-indicator" id="lb-indicator">1 / 3</div>
        </div>
    </div>

    <script>
        // 1. スクロールによるフェードイン表示 (Intersection Observer)
        document.addEventListener('DOMContentLoaded', () => {
            const observerOptions = {
                root: null,
                rootMargin: '0px',
                threshold: 0.15
            };

            const observer = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('is-visible');
                        observer.unobserve(entry.target);
                    }
                });
            }, observerOptions);

            document.querySelectorAll('.fade-in').forEach((el) => {
                observer.observe(el);
            });

            // ページロード直後にファーストビューをフェードイン
            setTimeout(() => {
                document.querySelectorAll('.hero .fade-in').forEach(el => el.classList.add('is-visible'));
            }, 100);
        });

        // 2. 非常に滑らかなパララックス効果 (画像用)
        window.addEventListener('scroll', () => {
            const parallaxItems = document.querySelectorAll('.parallax-item');
            const scrollY = window.scrollY;

            parallaxItems.forEach(item => {
                // スクロール量に応じて、画像を少しだけ下にずらす（窓枠効果）
                // 控えめなエフェクトにするために係数を小さく設定
                const speed = 0.05;
                item.style.transform = `translateY(${scrollY * speed}px)`;
            });

            // ヘッダーに影をつける処理
            const header = document.querySelector('header');
            if (scrollY > 50) {
                header.style.boxShadow = '0 4px 20px rgba(0,0,0,0.06)';
            } else {
                header.style.boxShadow = '0 4px 20px rgba(0,0,0,0.02)';
            }
            // 3. Lightbox Gallery Logic
            const state = {
                images: [],
                currentIndex: 0
            };

            const lightbox = document.getElementById('lightbox');
            const lbClose = document.getElementById('lb-close');
            const lbPrev = document.getElementById('lb-prev');
            const lbNext = document.getElementById('lb-next');
            const lbContainer = document.getElementById('lb-image-container');
            const lbIndicator = document.getElementById('lb-indicator');

            // 各画像ラッパーにクリックイベントを登録
            document.querySelectorAll('.gallery-trigger').forEach(trigger => {
                trigger.addEventListener('click', (e) => {
                    // imgタグから data-images 属性を取得して配列にする
                    const imgEl = trigger.querySelector('img');
                    const imageListStr = imgEl.getAttribute('data-images');
                    if (!imageListStr) return;

                    state.images = imageListStr.split(',').map(src => src.trim());
                    state.currentIndex = 0;

                    openLightbox();
                });
            });

            function openLightbox() {
                renderImages();
                updateLightboxView();
                lightbox.classList.add('active');
                document.body.style.overflow = 'hidden'; // 背景スクロール禁止
            }

            function closeLightbox() {
                lightbox.classList.remove('active');
                document.body.style.overflow = 'auto'; // スクロール復活
            }

            function renderImages() {
                // コンテナ内を一旦クリア（レンズは残すために一時退避）
                const lens = document.getElementById('zoom-lens');
                lbContainer.innerHTML = '';
                if (lens) lbContainer.appendChild(lens);

                state.images.forEach((src, idx) => {
                    const img = document.createElement('img');
                    img.src = src;
                    img.className = 'lightbox-img';
                    if (idx === state.currentIndex) {
                        img.classList.add('active');
                    }
                    lbContainer.appendChild(img);
                });
            }

            function updateLightboxView() {
                const imgs = lbContainer.querySelectorAll('.lightbox-img');
                imgs.forEach((img, idx) => {
                    if (idx === state.currentIndex) {
                        img.classList.add('active');
                    } else {
                        img.classList.remove('active');
                    }
                });
                lbIndicator.innerText = `${state.currentIndex + 1} / ${state.images.length}`;

                // 矢印の表示制御 (1枚しかない場合は消す)
                lbPrev.style.display = state.images.length > 1 ? 'flex' : 'none';
                lbNext.style.display = state.images.length > 1 ? 'flex' : 'none';
            }

            function nextImage() {
                state.currentIndex = (state.currentIndex + 1) % state.images.length;
                updateLightboxView();
            }

            function prevImage() {
                state.currentIndex = (state.currentIndex - 1 + state.images.length) % state.images.length;
                updateLightboxView();
            }

            // --- 虫眼鏡 확대 (Zoom) ロジック ---
            const zoomLens = document.getElementById('zoom-lens');
            let isZoomActive = false; // マウスが押されているかどうかのフラグ

            // 画像自体のデフォルトのドラッグ動作を禁止する（クリック＆ホールドの邪魔になるため）
            lbContainer.addEventListener('dragstart', (e) => {
                e.preventDefault();
            });

            // mousedown: マウスを押した時にレンズを表示してズームを開始
            lbContainer.addEventListener('mousedown', (e) => {
                // 左クリック以外（右クリックなど）は無視
                if (e.button !== 0) return;

                const currentImg = lbContainer.querySelector('.lightbox-img.active');
                if (!currentImg) return;

                isZoomActive = true;
                zoomLens.style.display = 'block';
                lbContainer.classList.add('is-zooming');

                // 初回の位置計算と背景設定をすぐに行う
                updateLensPosition(e, currentImg);
            });

            // mouseup と mouseleave: マウスを離すか領域外に出たら終了
            const stopZoom = () => {
                isZoomActive = false;
                zoomLens.style.display = 'none';
                lbContainer.classList.remove('is-zooming');
            };

            window.addEventListener('mouseup', stopZoom); // コンテナ外で離した場合も考慮
            lbContainer.addEventListener('mouseleave', stopZoom);

            // mousemove: マウスを動かした時、フラグがtrueならレンズを追従
            lbContainer.addEventListener('mousemove', (e) => {
                if (!isZoomActive) return; // 押していなければ何もしない

                const currentImg = lbContainer.querySelector('.lightbox-img.active');
                if (!currentImg) return;

                updateLensPosition(e, currentImg);
            });

            // レンズの位置と背景位置を計算・更新する共通関数
            function updateLensPosition(e, currentImg) {
                const rect = currentImg.getBoundingClientRect();
                const containerRect = lbContainer.getBoundingClientRect();

                // 常に現在の画像のsrcとsizeで背景を上書きする
                zoomLens.style.backgroundImage = `url('${currentImg.src}')`;
                zoomLens.style.backgroundSize = `${currentImg.width * 2.5}px ${currentImg.height * 2.5}px`;

                // 画像の範囲外なら非表示・処理終了
                if (e.clientX < rect.left || e.clientX > rect.right || e.clientY < rect.top || e.clientY > rect.bottom) {
                    zoomLens.style.display = 'none';
                    return;
                } else {
                    zoomLens.style.display = 'block';
                }

                // マウス座標を取得 (画像内の相対座標)
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                // レンズの位置をマウスに追従 (コンテナ内の相対座標)
                const lensX = e.clientX - containerRect.left - (zoomLens.offsetWidth / 2);
                const lensY = e.clientY - containerRect.top - (zoomLens.offsetHeight / 2);

                zoomLens.style.left = `${lensX}px`;
                zoomLens.style.top = `${lensY}px`;

                // 背景画像の位置を調整して拡大部分を合致させる
                const ratioX = x / currentImg.width;
                const ratioY = y / currentImg.height;

                const bgPosX = -(ratioX * (currentImg.width * 2.5) - zoomLens.offsetWidth / 2);
                const bgPosY = -(ratioY * (currentImg.height * 2.5) - zoomLens.offsetHeight / 2);

                zoomLens.style.backgroundPosition = `${bgPosX}px ${bgPosY}px`;
            }

            // イベントリスナー
            lbClose.addEventListener('click', closeLightbox);
            lbNext.addEventListener('click', nextImage);
            lbPrev.addEventListener('click', prevImage);

            // オーバーレイの背景クリックで閉じる
            lightbox.addEventListener('click', (e) => {
                if (e.target === lightbox || e.target.classList.contains('lightbox-slider')) {
                    closeLightbox();
                }
            });

            // キーボード操作
            document.addEventListener('keydown', (e) => {
                if (!lightbox.classList.contains('active')) return;
                if (e.key === 'Escape') closeLightbox();
                if (e.key === 'ArrowRight') nextImage();
                if (e.key === 'ArrowLeft') prevImage();
            });
        });
    </script>
</body>

</html>